<%- include("partials/top") %>
<section class="card fade-in narrow-lg">
  <div class="section-head">
    <h1>Mein Profil</h1>
    <p class="subtle">Persoenliche Einstellungen und Profildaten bearbeiten.</p>
  </div>

  <div class="tab-nav">
    <button class="tab-btn active" data-tab="profil">Profil</button>
    <button class="tab-btn" data-tab="passwort">Passwort</button>
  </div>

  <!-- Tab: Profil -->
  <div class="tab-panel active" id="tab-profil">
    <!-- Avatar -->
    <div class="profil-avatar-section">
      <div class="profil-avatar-wrap">
        <% if (profile.avatar) { %>
          <img src="/uploads/avatars/<%= profile.avatar %>" alt="Avatar" class="profil-avatar-img" id="avatarPreview" />
        <% } else { %>
          <div class="profil-avatar-initials" id="avatarPreview">
            <%= profile.first_name ? profile.first_name[0].toUpperCase() : '' %><%= profile.last_name ? profile.last_name[0].toUpperCase() : '' %>
          </div>
        <% } %>
      </div>
      <form method="post" action="/profil/avatar" enctype="multipart/form-data" class="profil-avatar-form">
        <input type="hidden" name="csrfToken" value="<%= csrfToken %>" />
        <label class="btn btn-secondary btn-sm profil-avatar-btn">
          Bild aendern
          <input type="file" name="avatar" accept=".jpg,.jpeg,.png,.webp" hidden id="avatarInput" />
        </label>
        <button type="submit" class="btn btn-sm" id="avatarSubmit" style="display: none;">Hochladen</button>
        <span class="subtle profil-avatar-hint">JPG, PNG oder WebP, max. 2 MB</span>
      </form>
    </div>

    <!-- Profile data -->
    <form method="post" action="/profil/update" class="form-grid">
      <input type="hidden" name="csrfToken" value="<%= csrfToken %>" />
      <div class="form-row-2">
        <label>Vorname
          <input name="firstName" required maxlength="60" value="<%= profile.first_name %>" />
        </label>
        <label>Nachname
          <input name="lastName" maxlength="60" value="<%= profile.last_name %>" />
        </label>
      </div>
      <label>E-Mail (optional)
        <input type="email" name="email" maxlength="120" value="<%= profile.email %>" />
      </label>
      <label>Adresse (optional)
        <textarea name="address" maxlength="200" rows="3"><%= profile.address %></textarea>
      </label>
      <label>Telefone (optional, 1-3, per Komma)
        <input name="phones" maxlength="120" value="<%= (profile.phones || []).join(", ") %>" />
      </label>
      <button type="submit">Profil speichern</button>
    </form>
  </div>

  <!-- Tab: Passwort -->
  <div class="tab-panel" id="tab-passwort">
    <form method="post" action="/profil/password" class="form-grid">
      <input type="hidden" name="csrfToken" value="<%= csrfToken %>" />
      <label>Aktuelles Passwort
        <input type="password" name="currentPassword" required autocomplete="current-password" />
      </label>
      <label>Neues Passwort (min. 8 Zeichen)
        <input type="password" name="newPassword" required minlength="8" autocomplete="new-password" />
      </label>
      <label>Neues Passwort bestaetigen
        <input type="password" name="confirmPassword" required minlength="8" autocomplete="new-password" />
      </label>
      <button type="submit">Passwort aendern</button>
    </form>
  </div>
</section>
<%- include("partials/bottom") %>
